<%= link_to room_path(room, access_token: params[:access_token].present? ? params[:access_token]:nil), class: "#{ 'room-item-with-settings' if can? :update, room } room-item list-group-item #{ 'active' if room.id == (params[:id].to_i) && params[:controller] == 'rooms' }" do %>
  <div class="media" data-room-id="<%= room.id %>">
    <div class="media-left"></div>
    <div class="media-body">
      <h4 class="media-heading"><%= room.title %></h4>
      <span class="room-item-replies"><%= room.messages.count %> <%= 'reply'.pluralize(room.messages.count) %></span>
      <% if room_unread_messages(room) > 0 %>
        | <span class="badge"><%= room_unread_messages(room) %></span> unread
      <% end %>
      <% if room.messages.first %>
        | updated <%= time_ago_in_words(room.messages.first.created_at) %> ago
      <% end %>
      <% if room.locked %>
        | Locked <%= fa_icon 'lock' %>
      <% end %>
    </div>
  </div>
<% end %>
<% if can? :update, room %>
  <div class="dropdown room-item-settings">
    <button class="btn btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">
      <%= fa_icon 'bars' %>
    </button>
    <ul class="dropdown-menu" aria-labelledby="dropdownMenu1">
      <li>
        <% unless room.locked %>
          <%= link_to 'Lock', lock_room_path(room) %>
        <% end %>
        <% if room.locked %>
          <%= link_to 'Unlock', unlock_room_path(room) %>
        <% end %>
      </li>
    </ul>
  </div>
<% end %>
